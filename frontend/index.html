<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Azubi Voice Assistant ü§ñüîä</title>

  <!-- Option A: inline styles (quick) -->
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --danger:#f87171; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--text); }
    .wrap { max-width: 820px; margin: 40px auto; padding: 24px; }
    .card { background: var(--card); border: 1px solid #1f2937; border-radius: 16px; padding: 20px; box-shadow: 0 10px 24px rgba(0,0,0,.25); }
    h1 { margin:0 0 6px; font-size: 28px; }
    p.sub { margin:0 0 18px; color: var(--muted); }
    label { display:block; font-weight:600; margin: 14px 0 6px; }
    textarea { width:100%; min-height:140px; padding:12px; border-radius:10px; border:1px solid #243244; background:#0b1220; color:var(--text); resize:vertical; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    select, input[type="text"] { flex:1; min-width: 200px; padding:10px; border-radius:10px; border:1px solid #243244; background:#0b1220; color:var(--text); }
    .controls { display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin-top:10px; }
    .switch { display:flex; align-items:center; gap:8px; color:var(--muted); font-size:14px; }
    button { appearance:none; border:0; padding:12px 18px; border-radius:12px; font-weight:700; cursor:pointer; background:var(--accent); color:#052e13; transition: transform .04s ease; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    button:active { transform: translateY(1px); }
    .hint { color:var(--muted); font-size: 13px; margin-top:6px; }
    .meta { display:flex; justify-content:space-between; align-items:center; margin-top:6px; }
    .count { color:var(--muted); font-size:12px; }
    .error { color: var(--danger); font-weight:600; margin-top:10px; }
    audio { width:100%; margin-top:16px; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#0b1220; border:1px solid #243244; color:var(--text); padding:2px 6px; border-radius:6px; font-size: 0.9em; }
    .footer { margin-top:18px; color:var(--muted); font-size: 12px; }
  </style>

  <!-- Option B: external CSS (nice for ongoing work) -->
  <!-- <link rel="stylesheet" href="styles.css"> -->
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Azubi Voice Assistant</h1>
      <p class="sub">Type text ‚Üí get audio from your AWS backend (Polly via Lambda). For more natural speech, toggle ‚ÄúAdd pauses (SSML)‚Äù.</p>

      <label for="text">Text</label>
      <textarea id="text" placeholder="Hello from Azubi VA. Don‚Äôt worry, I am not Skynet. The stipends will come. Please let Flo rest a little.">Hello from Azubi VA. Don‚Äôt worry, I am not Skynet. The stipends will come. Please let Flo rest a little.</textarea>
      <div class="meta">
        <div class="hint">Tip: keep it short during development.</div>
        <div class="count" id="charCount">0 / 3000</div>
      </div>

      <div class="row">
        <div style="flex:2; min-width:240px;">
          <label for="voice">Voice</label>
          <select id="voice">
            <option>Joanna</option><option>Matthew</option><option>Amy</option><option>Emma</option><option>Brian</option>
            <option>Ivy</option><option>Kendra</option><option>Justin</option><option>Kevin</option><option>Kimberly</option>
          </select>
        </div>
        <div style="flex:1; min-width:160px;">
          <label for="format">Format</label>
          <select id="format">
            <option value="mp3" selected>mp3</option>
            <option value="ogg_vorbis">ogg_vorbis</option>
            <option value="pcm">pcm</option>
          </select>
        </div>
      </div>

      <div class="controls">
        <label class="switch"><input type="checkbox" id="ssml"> Add pauses (SSML)</label>
        <button id="speakBtn">üîä Speak</button>
        <span id="status" class="hint"></span>
      </div>

      <div id="error" class="error" style="display:none;"></div>

      <audio id="player" controls preload="none"></audio>

      <div class="footer">
        API base: <span class="kbd" id="apiBaseDisplay"></span>
      </div>
    </div>
  </div>

  <script>
    // ======= CONFIG =======
    const API_BASE_URL = " https://3f1g9ndm9l.execute-api.us-east-1.amazonaws.com"; 
    const MAX_CHARS = 3000; 
    document.getElementById('apiBaseDisplay').textContent = API_BASE_URL;

    const textEl = document.getElementById('text');
    const voiceEl = document.getElementById('voice');
    const formatEl = document.getElementById('format');
    const ssmlEl = document.getElementById('ssml');
    const speakBtn = document.getElementById('speakBtn');
    const statusEl = document.getElementById('status');
    const errorEl = document.getElementById('error');
    const player = document.getElementById('player');
    const charCount = document.getElementById('charCount');

    // live char counter
    function updateCount() {
      const len = textEl.value.length;
      charCount.textContent = `${len} / ${MAX_CHARS}`;
      charCount.style.color = len > MAX_CHARS ? 'var(--danger)' : 'var(--muted)';
    }
    textEl.addEventListener('input', updateCount);
    updateCount();

    // naive SSML helper: inserts a 400ms break after sentence-ending periods (basic English heuristics)
    function textToSsml(text) {
      const escaped = text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');

      const withBreaks = escaped
        .replace(/\.\s+/g, ". <break time='400ms'/> ")
        .trim();

      return `<speak>${withBreaks}</speak>`;
    }

    async function speak() {
      errorEl.style.display = 'none';
      errorEl.textContent = '';

      const text = textEl.value.trim();
      const voiceId = voiceEl.value;
      const format = formatEl.value;
      const useSsml = ssmlEl.checked;

      if (!text) {
        errorEl.textContent = "Please enter some text.";
        errorEl.style.display = 'block';
        return;
      }
      if (text.length > MAX_CHARS && !useSsml) {
        errorEl.textContent = `Text too long (${text.length}). Limit: ${MAX_CHARS}.`;
        errorEl.style.display = 'block';
        return;
      }

      // build payload
      const payload = useSsml
        ? { text: textToSsml(text), voiceId, format, useSsml: true }
        : { text, voiceId, format };

      speakBtn.disabled = true;
      const prevLabel = speakBtn.textContent;
      speakBtn.textContent = "Synthesizing‚Ä¶";
      statusEl.textContent = "Contacting API‚Ä¶";

      try {
        const res = await fetch(API_BASE_URL + "/speak", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const maybeText = await res.text();
          let msg = `Request failed (${res.status})`;
          try { msg += `: ${JSON.parse(maybeText).error || maybeText}`; } catch { msg += `: ${maybeText}`; }
          throw new Error(msg);
        }

        const data = await res.json();
        if (!data.audioUrl) throw new Error("No audioUrl returned from API.");

        statusEl.textContent = "Loading audio‚Ä¶";
        player.src = data.audioUrl;
        try { await player.play(); } catch {}
        statusEl.textContent = "Done.";
      } catch (err) {
        errorEl.textContent = err.message || String(err);
        errorEl.style.display = 'block';
        statusEl.textContent = "";
      } finally {
        speakBtn.disabled = false;
        speakBtn.textContent = prevLabel;
      }
    }

    speakBtn.addEventListener('click', speak);
  </script>
</body>
</html>
